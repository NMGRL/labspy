{% extends "base.html" %}

{% block staticfiles %}
    {% load static %}
{#    <link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">#}
{#    <link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap-responsive.min.css">#}
{#    <script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>#}

    <link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
    <script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>

    <link rel="stylesheet" type="text/css" href="{% static 'status/graph.css' %}" />
    <link rel="stylesheet" type="text/css" href="{% static 'django_tables2/themes/paleblue/css/screen.css' %}" />
{#    <script src="{% static 'bootstrap/js/bootstrap.min.js' %}" type="text/javascript"></script>#}
{#    <script type="text/javascript" src='http://www.flotcharts.org/flot/jquery.flot.js'></script>#}
{#    <script type="text/javascript" src='http://www.flotcharts.org/flot/jquery.flot.time.js'></script>#}
    <script type="text/javascript" src="{% static 'jquery.flot.js' %}"></script>
    <script type="text/javascript" src="{% static 'jquery.flot.time.js' %}"></script>
{% endblock %}


{% block body %}
    <div id="container">
        <button type="button" class="btn btn-info" data-toggle="collapse"
                    data-target="#experimentscontainer">Experiments</button>
        <div id="experimentscontainer" class="rounded collapse out">
            <table>
                <tr>
                {% for spec, exp, ai in experiments %}
                    <td>
                        <div id="experimentcontainer">
                            <h4 style="font-variant: small-caps; font-weight: bold">{{ spec }}</h4>
                            <table class="paleblue">
                                <thead>
                                <td></td><td>Name</td><td>Timestamp</td>
                                </thead>
                                <tr><td>Experiment</td><td>{{ exp.name }}</td><td>{{ exp.start_time|date:"m/d/y h:i:s A" }}</td></tr>
                                <tr><td>Analysis</td><td>{{ ai.name }}</td><td>{{ ai.start_time|date:"m/d/y h:i:s A" }}</td></tr>
                            </table>
                        </div>
                    </td>
                {% endfor %}
                </tr>
            </table>
        </div>
        <button type="button" class="btn btn-info" data-toggle="collapse"
                    data-target="#currentcontainer">Current</button>
        <div id="currentcontainer" class="collapse out">
            <table class="paleblue">
                <thead><td>Name</td><td>Value</td><td>Units</td><td>Timestamp</td></thead>
                {% for ti,ci,ui, tsi in current %}
                    <tr><td>{{ ti }}</td><td>{{ ci|floatformat:2 }}</td><td>{{ ui }}</td><td>{{ tsi|date:"m/d/Y h:i:s A" }}</td></tr>
                {% endfor %}
            </table>
        </div>
        <button type="button" class="btn btn-info" data-toggle="collapse"
                    data-target="#connectioncontainer">Connections</button>
        <div id="connectioncontainer" class="collapse out">
            <div class="row">
                {% for name, ts, connections in connections_list %}
                    <div class="col-md-{{ nconnections }}">
                        <p class="connection"><strong>{{ name }}</strong> {{ ts|date:"m/d/y h:i:s A"}}</p>
                        <table class="paleblue">
                            <thead>
                                <td>Application</td>
                                <td>Device</td>
                                <td>Communicator</td>
                                <td>Address</td>
                                <td>Status</td>
                            </thead>
                            {% for conn in connections %}
                                {% if conn.status %}
                                    <tr class="status_true">
                                {% else %}
                                    <tr class="status_false">
                                {% endif %}
                                    <td>{{ conn.appname }}</td>
                                <td>{{ conn.devname }}</td>
                                <td>{{ conn.com }}</td>
                                <td>{{ conn.address }}</td>
                                {% if conn.status %}
                                    <td>OK</td>
                                {% else %}
                                    <td>FAIL</td>
                                {% endif %}
                                </tr>
                            {% endfor %}
                        </table>
                    </div>
                {% endfor %}
            </div>
        </div>
        <button type="button" class="btn btn-info" data-toggle="collapse"
                    data-target="#graphcontainer">Graphs</button>
        <div class="container">
            <form action={% url "status_index" %} method="post">
                {% csrf_token %}
                {{ date_selector_form }}
                <input type="submit" value="Refresh" />
            </form>

            <form action={% url "status_index" %} method="post">
                {% csrf_token %}
                {{ save_figure_form }}
                <input type="submit" value="Save Figure" />
            </form>

            {% for rows in graphrows %}
                <div class="row">
                    {% for title, label, id, graph in rows %}
                    <div class="col-md-6">

                        <table class="graph">
                            <tr><td></td><td><div class='graphtitle'>{{ title }}</div></td></tr>
                            <tr>
                                <td id="ylabel"><div>{{ label }}</div></td>
                                <td><div id="{{ id }}" style="width:500px;height:300px;"></div></td>
                            </tr>
                            <tr><td></td><td><div id="xlabel">Time</div></td></tr>
                        </table>
                        <script type='text/javascript'>
                        $.plot($("#{{ id }}"), {{ graph.json_data|safe}}, {{ graph.options|safe }});
                        </script>
                        </div>
                    {% endfor %}
                </div>
            {% endfor %}
        </div>
    </div>

{#    auto reload script#}
    <script type='text/javascript'>
        setTimeout(function(){
   window.location.reload(1);
        }, 60000);
    </script>

{% endblock %}

{#    <script type='text/javascript'>#}
{#        $.plot($("#pneumatic_graph"), {{ pneumatic.json_data|safe}}, {{ pneumatic.options|safe }});#}
{#    </script>#}
{#    <script type='text/javascript'>#}
{#        $.plot($("#temp_graph"), {{ temp.json_data|safe}}, {{ temp.options|safe }});#}
{#    </script>#}
{#    <script type='text/javascript'>#}
{#        $.plot($("#hum_graph"), {{ hum.json_data|safe}}, {{ hum.options|safe }});#}
{#    </script>#}
{#    <script type='text/javascript'>#}
{#        $.plot($("#coolant_graph"), {{ coolant.json_data|safe}}, {{ coolant.options|safe }});#}
{#    </script>#}
{#    <script type='text/javascript'>#}
{#        $.plot($("#cf_graph"), {{ cfinger.json_data|safe}}, {{ cfinger.options|safe }});#}
{#    </script>#}

{#        <div id="graphcontainer" class="collapse in">#}
{#            <form action={% url "status_index" %} method="post">#}
{#                {% csrf_token %}#}
{#                {{ date_selector_form }}#}
{#                <input type="submit" value="Refresh" />#}
{#            </form>#}
{##}
{#            <form action={% url "status_index" %} method="post">#}
{#                {% csrf_token %}#}
{#                {{ save_figure_form }}#}
{#                <input type="submit" value="Save Figure" />#}
{#            </form>#}
{##}
{#            <table>#}
{#                <tr>#}
{#                    <td>#}
{#                        <table class="graph">#}
{#                            <tr><td></td><td><div class='graphtitle'>Lab Temperature</div></td></tr>#}
{#                            <tr>#}
{#                                <td id="ylabel"><div>Temp (F)</div></td>#}
{#                                <td><div id="temp_graph" style="width:500px;height:300px;"></div></td>#}
{#                            </tr>#}
{#                            <tr><td></td><td><div id="xlabel">Time</div></td></tr>#}
{#                        </table>#}
{#                    </td>#}
{#                    <td>#}
{#                        <table class="graph">#}
{#                            <tr><td></td><td><div class='graphtitle'>Lab Humidity</div></td></tr>#}
{#                            <tr>#}
{#                                <td id="ylabel"><div>Humidity (%)</div></td>#}
{#                                <td><div id="hum_graph" style="width:500px;height:300px;"></div></td>#}
{#                            </tr>#}
{#                            <tr><td></td><td><div id="xlabel">Time</div></td></tr>#}
{#                        </table>#}
{#                    </td>#}
{#                </tr>#}
{#                </table>#}
{##}
{#                <table>#}
{#                <tr>#}
{#                    <td>#}
{#                        <table class="graph">#}
{#                            <tr><td></td><td><div class='graphtitle'>Coolant Temperature</div></td></tr>#}
{#                            <tr>#}
{#                                <td id="ylabel"><div>Temp ({{ coolant_units }})</div></td>#}
{#                                <td><div id="coolant_graph" style="width:500px;height:300px;"></div></td>#}
{#                            </tr>#}
{#                            <tr><td></td><td><div id="xlabel">Time</div></td></tr>#}
{#                        </table>#}
{#                    </td>#}
{#                    <td>#}
{#                        <table class="graph">#}
{#                            <tr><td></td><td><div class='graphtitle'>ColdFinger Temperature</div></td></tr>#}
{#                            <tr>#}
{#                                <td id="ylabel"><div>Temp ({{ coldfinger_units }})</div></td>#}
{#                                <td><div id="cf_graph" style="width:500px;height:300px;"></div></td>#}
{#                            </tr>#}
{#                            <tr><td></td><td><div id="xlabel">Time</div></td></tr>#}
{#                        </table>#}
{#                    </td>#}
{#                </tr>#}
{#                </table>#}
{##}
{#                <table>#}
{#                <tr>#}
{#                    <td>#}
{#                        <table class="graph">#}
{#                            <tr><td></td><td><div class='graphtitle'>Air Pressure</div></td></tr>#}
{#                            <tr>#}
{#                                <td id="ylabel"><div>Pressure ({{ pneumatic_units }})</div></td>#}
{#                                <td><div id="pneumatic_graph" style="width:500px;height:300px;"></div></td>#}
{#                            </tr>#}
{#                            <tr><td></td><td><div id="xlabel">Time</div></td></tr>#}
{#                        </table>#}
{#                    </td>#}
{#                    <td>#}
{#                        <table class="graph">#}
{#                            <tr><td></td><td><div class='graphtitle'></div></td></tr>#}
{#                            <tr>#}
{#                                <td><div id="ylabel"></div></td>#}
{#                                <td><div id="cf_graph" style="width:500px;height:300px;"></div></td>#}
{#                            </tr>#}
{#                            <tr><td></td><td><div id="xlabel">Time</div></td></tr>#}
{#                        </table>#}
{#                    </td>#}
{#                </tr>#}
{#                </table>#}
{##}
{#        </div>#}